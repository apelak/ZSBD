DROP TABLE JOB_HISTORY 
DROP TABLE REGIONS CASCADE CONSTRAINTS
DROP TABLE COUNTRIES CASCADE CONSTRAINTS
DROP TABLE JOBS CASCADE CONSTRAINTS
DROP TABLE EMPLOYEES CASCADE CONSTRAINTS
DROP TABLE LOCATIONS CASCADE CONSTRAINTS
DROP TABLE DEPARTMENTS CASCADE CONSTRAINTS

TABLE_NAME|
----------+

CREATE TABLE COUNTRIES AS SELECT * FROM HR.COUNTRIES
CREATE TABLE DEPARTMENTS AS SELECT * FROM HR.DEPARTMENTS
CREATE TABLE EMPLOYEES AS SELECT * FROM HR.EMPLOYEES 
CREATE TABLE JOBS AS SELECT * FROM HR.JOBS
CREATE TABLE JOB_GRADES AS SELECT * FROM HR.JOB_GRADES
CREATE TABLE JOB_HISTORY AS SELECT * FROM HR.JOB_HISTORY
CREATE TABLE LOCATIONS AS SELECT * FROM HR.LOCATIONS
CREATE TABLE PRODUCTS AS SELECT * FROM HR.PRODUCTS
CREATE TABLE REGIONS AS SELECT * FROM HR.REGIONS
CREATE TABLE SALES AS SELECT * FROM HR.SALES

ALTER TABLE COUNTRIES 
ADD CONSTRAINT COUNTRY_C_ID_PK
PRIMARY KEY (COUNTRY_ID)

ALTER TABLE DEPARTMENTS 
ADD CONSTRAINT DEPT_ID_PK 
PRIMARY KEY (DEPARTMENT_ID)

ALTER TABLE EMPLOYEES 
ADD CONSTRAINT EMP_EMAIL_ID_PK
PRIMARY KEY (EMPLOYEE_ID)

ALTER TABLE JOBS
ADD CONSTRAINT JOB_ID_PK
PRIMARY KEY (JOB_ID)

ALTER TABLE JOB_HISTORY 
ADD CONSTRAINT JHIST_EMP_ID_ST_DATE_PK
PRIMARY KEY (EMPLOYEE_ID, START_DATE)

ALTER TABLE LOCATIONS
ADD CONSTRAINT LOC_ID_PK
PRIMARY KEY (LOCATION_ID)

ALTER TABLE PRODUCTS 
ADD CONSTRAINT PROD_ID_PK
PRIMARY KEY (PRODUCT_ID)

ALTER TABLE JOB_GRADES 
ADD CONSTRAINT JGRAD_GRAD_PK
PRIMARY KEY (GRADE)

ALTER TABLE REGIONS
ADD CONSTRAINT REG_ID_PK
PRIMARY KEY (REGION_ID)

ALTER TABLE SALES
ADD CONSTRAINT SAL_ID_PK
PRIMARY KEY (SALE_ID)

ALTER TABLE COUNTRIES 
ADD CONSTRAINT COUN_REG_FK
FOREIGN KEY (REGION_ID)
REFERENCES REGIONS(REGION_ID)

ALTER TABLE LOCATIONS 
ADD CONSTRAINT LOC_COUN_FK
FOREIGN KEY (COUNTRY_ID)
REFERENCES COUNTRIES(COUNTRY_ID)

ALTER TABLE DEPARTMENTS 
ADD CONSTRAINT DEP_LOC_FK
FOREIGN KEY (LOCATION_ID)
REFERENCES LOCATIONS(LOCATION_ID)

ALTER TABLE DEPARTMENTS 
ADD CONSTRAINT DEP_EMPL_FK
FOREIGN KEY (MANAGER_ID)
REFERENCES EMPLOYEES(EMPLOYEE_ID)

ALTER TABLE EMPLOYEES 
ADD CONSTRAINT EMPL_EMPL_FK
FOREIGN KEY (MANAGER_ID)
REFERENCES EMPLOYEES(EMPLOYEE_ID)

ALTER TABLE EMPLOYEES 
ADD CONSTRAINT EMPL_DEP_FK
FOREIGN KEY (DEPARTMENT_ID)
REFERENCES DEPARTMENTS(DEPARTMENT_ID)

ALTER TABLE EMPLOYEES 
ADD CONSTRAINT EMPL_JOB_FK
FOREIGN KEY (JOB_ID)
REFERENCES JOBS(JOB_ID)

ALTER TABLE JOB_HISTORY 
ADD CONSTRAINT JOBHIS_EMP_FK
FOREIGN KEY (EMPLOYEE_ID)
REFERENCES EMPLOYEES(EMPLOYEE_ID)

ALTER TABLE JOB_HISTORY 
ADD CONSTRAINT JOBHIS_JOB_FK
FOREIGN KEY (JOB_ID)
REFERENCES JOBS(JOB_ID)

ALTER TABLE JOB_HISTORY 
ADD CONSTRAINT JOBHIS_DEP_FK
FOREIGN KEY (DEPARTMENT_ID)
REFERENCES DEPARTMENTS(DEPARTMENT_ID)

ALTER TABLE SALES
ADD CONSTRAINT SAL_PRD_FK
FOREIGN KEY (PRODUCT_ID)
REFERENCES PRODUCTS(PRODUCT_ID)

##ZADANIE 1
SELECT LAST_NAME||' '||SALARY AS NAZWISKO_I_ZAROBKI
FROM EMPLOYEES e 
WHERE 1=1
AND DEPARTMENT_ID IN (20, 50)
AND SALARY BETWEEN 2000 AND 7000
ORDER BY LAST_NAME

NAZWISKO_I_ZAROBKI|
------------------+
Vollman 6500      |
Mourgos 5800      |
Nayer 3200        |
Mikkilineni 2700  |
Landry 2400       |
Markle 2200       |
Bissot 3300       |
Atkinson 2800     |
Marlow 2500       |
Olson 2100        |
Mallin 3300       |
Rogers 2900       |
Gee 2400          |
Philtanker 2200   |
Ladwig 3600       |
Stiles 3200       |
Seo 2700          |
Patel 2500        |
Rajs 3500         |
Davies 3100       |
Matos 2600        |
Vargas 2500       |
Taylor 3200       |
Fleaur 3100       |
Sullivan 2500     |
Geoni 2800        |
Sarchand 4200     |
Bull 4100         |
Dellinger 3400    |
Cabrio 3000       |
Chung 3800        |
Dilly 3600        |
Gates 2900        |
Perkins 2500      |
Bell 4000         |
Everett 3900      |
McCain 3200       |
Jones 2800        |
Walsh 3100        |
Feeney 3000       |
OConnell 2600     |
Grant 2600        |
Fay 6000          |


##ZADANIE 2
SELECT HIRE_DATE,
	LAST_NAME,
	&kolumna
FROM EMPLOYEES e 
WHERE 1=1
AND MANAGER_ID IS NOT NULL 
AND EXTRACT(YEAR FROM hire_date) = 2005
ORDER BY &kolumna

##ZADANIE 3
SELECT
FIRST_NAME || ' ' || LAST_NAME AS NAME_AND_SURNAME,
PHONE_NUMBER,
SALARY
FROM PELAKA.EMPLOYEES
WHERE LAST_NAME LIKE '__e%'
AND FIRST_NAME LIKE '%&czesc_imienia%'
ORDER BY 1 DESC, 2 ASC;

##ZADANIE 4

SELECT
FIRST_NAME,
LAST_NAME,
MONTHS_BETWEEN(SYSDATE, HIRE_DATE) AS HIRE_MONTHS_COUNT,
CASE 
	WHEN MONTHS_BETWEEN(SYSDATE, HIRE_DATE) >= 200 THEN 0.3
	WHEN MONTHS_BETWEEN(SYSDATE, HIRE_DATE) > 150 THEN 0.2
	ELSE 0.1
END AS dodatek
FROM EMPLOYEES e 
ORDER BY MONTHS_BETWEEN(SYSDATE, HIRE_DATE) ASC 
	
	SELECT hire_date FROM EMPLOYEES e 

##ZADANIE 5

SELECT
DEPARTMENT_ID, SUM(SALARY) AS SUMA_ZAROBKOW, ROUND(AVG(SALARY)) AS SREDNIA_ZAROBKOW
FROM EMPLOYEES
GROUP BY DEPARTMENT_ID
HAVING MIN(SALARY) > 5000

##ZADANIE 6

SELECT e.LAST_NAME, e.DEPARTMENT_ID, d.DEPARTMENT_NAME, e.JOB_ID
FROM EMPLOYEES e
JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
JOIN LOCATIONS l on d.LOCATION_ID = l.LOCATION_ID
WHERE l.CITY = 'Toronto'

##ZADANIE 7

SELECT e2.FIRST_NAME, e2.LAST_NAME
FROM EMPLOYEES e1
JOIN EMPLOYEES e2 ON e1.DEPARTMENT_ID = e2.DEPARTMENT_ID
WHERE e1.FIRST_NAME = 'Jennifer'
AND e1.EMPLOYEE_ID <> e2.EMPLOYEE_ID

##ZADANIE 8 

SELECT DEPARTMENT_NAME
FROM DEPARTMENTS
WHERE DEPARTMENT_ID NOT IN 
(SELECT DISTINCT DEPARTMENT_ID FROM EMPLOYEES WHERE DEPARTMENT_ID IS NOT NULL)

##ZADANIE 9 

SELECT e.FIRST_NAME, e.LAST_NAME, e.JOB_ID, d.DEPARTMENT_NAME, e.SALARY, g.GRADE
FROM EMPLOYEES e
LEFT JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
JOIN JOB_GRADES g ON e.SALARY BETWEEN g.MIN_SALARY AND g.MAX_SALARY

##ZADANIE 10

SELECT FIRST_NAME, LAST_NAME, SALARY
FROM EMPLOYEES
WHERE SALARY > (SELECT AVG(SALARY) FROM EMPLOYEES)
ORDER BY SALARY DESC

##ZADANIE 11

SELECT EMPLOYEE_ID, FIRST_NAME, LAST_NAME
FROM EMPLOYEES
WHERE DEPARTMENT_ID IN 
(SELECT DISTINCT DEPARTMENT_ID FROM EMPLOYEES WHERE LAST_NAME LIKE '%u%')

##ZADANIE 12

SELECT FIRST_NAME, LAST_NAME, HIRE_DATE
FROM EMPLOYEES
WHERE HIRE_DATE < (SELECT TO_DATE(TRUNC(AVG(TO_NUMBER(TO_CHAR(HIRE_DATE, 'J')))), 'J')
FROM EMPLOYEES)

##ZADANIE 13

SELECT d.DEPARTMENT_NAME, COUNT(e.EMPLOYEE_ID) AS LICZBA_PRAC, AVG(e.SALARY) AS SREDNIA_PENSJA
FROM DEPARTMENTS d
LEFT JOIN EMPLOYEES e ON d.DEPARTMENT_ID = e.DEPARTMENT_ID
GROUP BY d.DEPARTMENT_NAME
ORDER BY LICZBA_PRAC DESC

##ZADANIE 14
SELECT FIRST_NAME, LAST_NAME, SALARY
FROM EMPLOYEES
WHERE SALARY < ANY (SELECT e.SALARY FROM EMPLOYEES e JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
WHERE d.DEPARTMENT_NAME = 'IT')

##ZADANIE 15
SELECT DISTINCT d.DEPARTMENT_NAME
FROM DEPARTMENTS d
JOIN EMPLOYEES e ON d.DEPARTMENT_ID = e.DEPARTMENT_ID
WHERE e.SALARY > (SELECT AVG(SALARY) FROM EMPLOYEES)

##ZADANIE 16

SELECT * FROM (
SELECT j.JOB_TITLE, AVG(e.SALARY) AS SREDNIA_PENSJA
FROM JOBS j
JOIN EMPLOYEES e ON j.JOB_ID = e.JOB_ID
GROUP BY j.JOB_TITLE
ORDER BY SREDNIA_PENSJA DESC)
WHERE ROWNUM <= 5

##ZADANIE 17

SELECT r.REGION_NAME, COUNT(DISTINCT c.COUNTRY_ID) AS LICZBA_KRAJOW, COUNT(e.EMPLOYEE_ID) AS LICZBA_PRAC
FROM REGIONS r
LEFT JOIN COUNTRIES c ON r.REGION_ID = c.REGION_ID
LEFT JOIN LOCATIONS l ON c.COUNTRY_ID = l.COUNTRY_ID
LEFT JOIN DEPARTMENTS d ON l.LOCATION_ID = d.LOCATION_ID
LEFT JOIN EMPLOYEES e ON d.DEPARTMENT_ID = e.DEPARTMENT_ID
GROUP BY r.REGION_NAME

##ZADANIE 18

SELECT e.FIRST_NAME, e.LAST_NAME, e.SALARY AS PENSJA_PRAC, m.SALARY AS PENSJA_SZEFA
FROM EMPLOYEES e
JOIN EMPLOYEES m ON e.MANAGER_ID = m.EMPLOYEE_ID
WHERE e.SALARY > m.SALARY

##ZADANIE 19

SELECT TO_CHAR(HIRE_DATE, 'MM') AS NUMER_MIESIACA, TO_CHAR(HIRE_DATE, 'Month') AS NAZWA_MIESIACA, COUNT(*) AS ILOSC
FROM EMPLOYEES
GROUP BY TO_CHAR(HIRE_DATE, 'MM'), TO_CHAR(HIRE_DATE, 'Month')
ORDER BY 1

##ZADANIE 20

SELECT * FROM (
SELECT d.DEPARTMENT_NAME, AVG(e.SALARY) AS SREDNIA_PENSJA
FROM DEPARTMENTS d
JOIN EMPLOYEES e ON d.DEPARTMENT_ID = e.DEPARTMENT_ID
GROUP BY d.DEPARTMENT_NAME
ORDER BY SREDNIA_PENSJA DESC
) WHERE ROWNUM <= 3
