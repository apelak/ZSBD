##ZADANIE 1

SELECT 
employee_id,
first_name,
last_name,
salary,
RANK() OVER (ORDER BY salary DESC) AS salary_rank
FROM employees

##ZADANIE 2

SELECT 
employee_id,
first_name,
last_name,
salary,
SUM(salary) OVER () AS total_salaries
FROM employees

##ZADANIE 3

SELECT
e.last_name,
p.product_name,
s.sale_date,
s.price * s.quantity AS order_value,
SUM(s.price * s.quantity) OVER (
PARTITION BY e.employee_id
ORDER BY s.sale_date
) AS running_employee_sales,
RANK() OVER (ORDER BY (s.price * s.quantity) DESC) AS global_sale_rank
FROM sales s
JOIN employees e ON s.employee_id = e.employee_id
JOIN products p ON s.product_id = p.product_id
ORDER BY e.last_name, s.sale_date

##ZADANIE 4

SELECT
e.last_name,
p.product_name,
s.price,
s.quantity,
TRUNC(s.sale_date) AS sale_day,
COUNT(*) OVER (
PARTITION BY p.product_id, TRUNC(s.sale_date)
) AS transactions_that_day,
SUM(s.price * s.quantity) OVER (
PARTITION BY p.product_id, TRUNC(s.sale_date)
) AS day_total,
LAG(s.price) OVER (
PARTITION BY p.product_id ORDER BY s.sale_date
) AS previous_price,
LEAD(s.price) OVER (
PARTITION BY p.product_id ORDER BY s.sale_date
) AS next_price
FROM sales s
JOIN employees e ON s.employee_id = e.employee_id
JOIN products p ON s.product_id = p.product_id
ORDER BY p.product_name, s.sale_date

##ZADANIE 5

SELECT
p.product_name,
s.price,
TO_CHAR(s.sale_date, 'YYYY-MM') AS sale_month,
SUM(s.price * s.quantity) OVER (
PARTITION BY s.product_id, TO_CHAR(s.sale_date, 'YYYY-MM')
) AS month_total,
SUM(s.price * s.quantity) OVER (
PARTITION BY s.product_id, TO_CHAR(s.sale_date, 'YYYY-MM')
ORDER BY s.sale_date
) AS month_running_total
FROM sales s
JOIN products p ON s.product_id = p.product_id
ORDER BY p.product_name, sale_month, s.sale_date

##ZADANIE 6

WITH daily AS (
SELECT
product_id,
TRUNC(sale_date) AS day_date,
TO_CHAR(sale_date,'YYYY') AS year,
AVG(price) AS daily_price
FROM sales
WHERE TO_CHAR(sale_date,'YYYY') IN ('2022','2023')
GROUP BY product_id, TRUNC(sale_date), TO_CHAR(sale_date,'YYYY')
)
SELECT
p.product_name,
p.product_category,
d22.daily_price AS price_2022,
d23.daily_price AS price_2023,
(d23.daily_price - d22.daily_price) AS price_difference
FROM products p
JOIN daily d22 ON p.product_id = d22.product_id AND d22.year = '2022'
JOIN daily d23 ON p.product_id = d23.product_id AND d23.year = '2023'
AND TO_CHAR(d22.day_date,'MM-DD') = TO_CHAR(d23.day_date,'MM-DD')

##ZADANIE 7

SELECT
product_category,
product_name,
price,
MIN(price) OVER (PARTITION BY product_category) AS min_price,
MAX(price) OVER (PARTITION BY product_category) AS max_price,
MAX(price) OVER (PARTITION BY product_category) - MIN(price) OVER (PARTITION BY product_category) AS price_diff
FROM products, sales
ORDER BY product_category, price;

##ZADANIE 8

SELECT
p.product_name,
s.sale_date,
s.price,
AVG(s.price) OVER (
PARTITION BY s.product_id
ORDER BY s.sale_date
ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING
) AS moving_avg_price
FROM sales s
JOIN products p ON s.product_id = p.product_id
ORDER BY p.product_name, s.sale_date

##ZADANIE 9

SELECT
product_category,
product_name,
price,
RANK() OVER (PARTITION BY product_category ORDER BY price DESC) AS price_rank,
ROW_NUMBER() OVER (PARTITION BY product_category ORDER BY price DESC) AS rn,
DENSE_RANK() OVER (PARTITION BY product_category ORDER BY price DESC) AS dense_price_rank
FROM products, sales
ORDER BY product_category, price DESC

##ZADANIE 10

SELECT
e.last_name,
p.product_name,
s.sale_date,
s.price * s.quantity AS order_value,
SUM(s.price * s.quantity) OVER (
PARTITION BY s.employee_id
ORDER BY s.sale_date
) AS employee_running_total,
RANK() OVER (
ORDER BY (s.price * s.quantity) DESC
) AS global_order_rank
FROM sales s
JOIN employees e ON s.employee_id = e.employee_id
JOIN products p ON s.product_id = p.product_id
ORDER BY e.last_name, s.sale_date

ZADANIE 11
  
SELECT DISTINCT
e.first_name,
e.last_name,
j.job_title
FROM employees e
JOIN sales s ON e.employee_id = s.employee_id
JOIN jobs j ON e.job_id = j.job_id
ORDER BY last_name, first_name













