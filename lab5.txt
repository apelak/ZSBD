##ZADANIE 1

DECLARE
    numer_max   PELAKA.DEPARTMENTS.DEPARTMENT_ID%TYPE;
    nowy_dep    PELAKA.DEPARTMENTS.DEPARTMENT_NAME%TYPE := 'EDUCATION';
BEGIN
    SELECT MAX(DEPARTMENT_ID)
    INTO numer_max
    FROM PELAKA.DEPARTMENTS;

    INSERT INTO PELAKA.DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME)
    VALUES (numer_max + 10, nowy_dep);

    DBMS_OUTPUT.PUT_LINE('Maksymalny numer departamentu: ' || numer_max);
    DBMS_OUTPUT.PUT_LINE('Dodano departament: ' || nowy_dep || ' o ID ' || (numer_max + 10));

END;


##ZADANIE 2

DECLARE
    numer_max   departments.department_id%TYPE;
    nowy_dep    departments.department_name%TYPE := 'EDUCATION';
    nowy_id     departments.department_id%TYPE;
BEGIN
    SELECT MAX(department_id)
    INTO numer_max
    FROM departments;

    nowy_id := numer_max + 10;

    INSERT INTO departments (department_id, department_name, location_id)
    VALUES (nowy_id, nowy_dep, NULL);

    UPDATE departments
    SET location_id = 3000
    WHERE department_id = nowy_id;

    DBMS_OUTPUT.PUT_LINE('Dodano i zaktualizowano departament ID=' || nowy_id);
END;

##ZADANIE 3

CREATE TABLE NOWA (
    POLE VARCHAR2(50)
);

BEGIN
    FOR i IN 1..10 LOOP
        IF i NOT IN (4, 6) THEN
            INSERT INTO PELAKA.NOWA (POLE) VALUES (TO_CHAR(i));
        END IF;
    END LOOP;
    
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('Wstawiono dane do tabeli NOWA.');
END;

SELECT * FROM PELAKA.NOWA;

##ZADANIE 4

DECLARE
    v_kraj COUNTRIES%ROWTYPE;
BEGIN
    SELECT *
    INTO v_kraj
    FROM COUNTRIES
    WHERE COUNTRY_ID = 'CA';

    DBMS_OUTPUT.PUT_LINE('Nazwa kraju: ' || v_kraj.COUNTRY_NAME);
    DBMS_OUTPUT.PUT_LINE('Region ID: ' || v_kraj.REGION_ID);
END;

##ZADANIE 5

DECLARE
    v_liczba_zmian NUMBER;
BEGIN
    UPDATE JOBS
    SET MIN_SALARY = MIN_SALARY * 1.05
    WHERE JOB_TITLE LIKE '%Manager%';
    
    v_liczba_zmian := SQL%ROWCOUNT;
    
    DBMS_OUTPUT.PUT_LINE('Liczba zaktualizowanych stanowisk: ' || v_liczba_zmian);
    
    ROLLBACK;
    DBMS_OUTPUT.PUT_LINE('Zmiany zostały cofnięte.');
END;

##ZADANIE 6

DECLARE
    v_job PELAKA.JOBS%ROWTYPE;
BEGIN
    SELECT *
    INTO v_job
    FROM (
        SELECT * FROM PELAKA.JOBS 
        ORDER BY MAX_SALARY DESC
    )
    WHERE ROWNUM = 1;

    DBMS_OUTPUT.PUT_LINE('Stanowisko z najwyższą pensją max: ' || v_job.JOB_TITLE);
    DBMS_OUTPUT.PUT_LINE('Maksymalne zarobki: ' || v_job.MAX_SALARY);
END;

##ZADANIE 7

DECLARE
    CURSOR c_kraje (p_region_id NUMBER) IS
        SELECT c.COUNTRY_NAME, COUNT(e.EMPLOYEE_ID) as LICZBA_PRAC
        FROM COUNTRIES c
        LEFT JOIN LOCATIONS l ON c.COUNTRY_ID = l.COUNTRY_ID
        LEFT JOIN DEPARTMENTS d ON l.LOCATION_ID = d.LOCATION_ID
        LEFT JOIN PEMPLOYEES e ON d.DEPARTMENT_ID = e.DEPARTMENT_ID
        WHERE c.REGION_ID = p_region_id
        GROUP BY c.COUNTRY_NAME;
        
    v_nazwa_kraju COUNTRIES.COUNTRY_NAME%TYPE;
    v_liczba      NUMBER;
BEGIN
    DBMS_OUTPUT.PUT_LINE('--- Raport dla regionu Europa (ID=1) ---');
    
    OPEN c_kraje(1);
    LOOP
        FETCH c_kraje INTO v_nazwa_kraju, v_liczba;
        EXIT WHEN c_kraje%NOTFOUND;
        
        DBMS_OUTPUT.PUT_LINE('Kraj: ' || v_nazwa_kraju || ', Liczba pracowników: ' || v_liczba);
    END LOOP;
    CLOSE c_kraje;
END;

##ZADANIE 8

DECLARE
    CURSOR c_pracownicy IS
        SELECT LAST_NAME, SALARY
        FROM PELAKA.EMPLOYEES
        WHERE DEPARTMENT_ID = 50;
        
    v_nazwisko PELAKA.EMPLOYEES.LAST_NAME%TYPE;
    v_zarobki  PELAKA.EMPLOYEES.SALARY%TYPE;
BEGIN
    OPEN c_pracownicy;
    LOOP
        FETCH c_pracownicy INTO v_nazwisko, v_zarobki;
        EXIT WHEN c_pracownicy%NOTFOUND;
        
        IF v_zarobki > 3100 THEN
            DBMS_OUTPUT.PUT_LINE(v_nazwisko || ': nie dawać podwyżki');
        ELSE
            DBMS_OUTPUT.PUT_LINE(v_nazwisko || ': dać podwyżkę');
        END IF;
    END LOOP;
    CLOSE c_pracownicy;
END;

##ZADANIE 9

DECLARE
    CURSOR c_szukaj (p_min_sal NUMBER, p_max_sal NUMBER, p_imie_part VARCHAR2) IS
        SELECT FIRST_NAME, LAST_NAME, SALARY
        FROM PELAKA.EMPLOYEES
        WHERE SALARY BETWEEN p_min_sal AND p_max_sal
          AND UPPER(FIRST_NAME) LIKE '%' || UPPER(p_imie_part) || '%';
          
    v_imie PELAKA.EMPLOYEES.FIRST_NAME%TYPE;
    v_nazw PELAKA.EMPLOYEES.LAST_NAME%TYPE;
    v_sal  PELAKA.EMPLOYEES.SALARY%TYPE;

    PROCEDURE WYPISZ_DANE IS
    BEGIN
        LOOP
            FETCH c_szukaj INTO v_imie, v_nazw, v_sal;
            EXIT WHEN c_szukaj%NOTFOUND;
            DBMS_OUTPUT.PUT_LINE(v_imie || ' ' || v_nazw || ' (' || v_sal || ')');
        END LOOP;
    END;

BEGIN
    DBMS_OUTPUT.PUT_LINE('--- Szukam: 1000-5000, imię z "a" ---');
    OPEN c_szukaj(1000, 5000, 'a');
    WYPISZ_DANE; 
    CLOSE c_szukaj;

    DBMS_OUTPUT.PUT_LINE('--- Szukam: 5000-20000, imię z "u" ---');
    OPEN c_szukaj(5000, 20000, 'u');
    WYPISZ_DANE;
    CLOSE c_szukaj;
END;

##ZADANIE 10

CREATE TABLE STATYSTYKI_MENEDZEROW (
    MANAGER_ID NUMBER,
    LICZBA_PODWLADNYCH NUMBER,
    ROZNICA_PENSJI NUMBER
);

BEGIN
    FOR r IN (
        SELECT MANAGER_ID, 
               COUNT(*) AS LICZBA, 
               MAX(SALARY) - MIN(SALARY) AS ROZNICA
        FROM EMPLOYEES
        WHERE MANAGER_ID IS NOT NULL
        GROUP BY MANAGER_ID
    ) LOOP
        INSERT INTO STATYSTYKI_MENEDZEROW (MANAGER_ID, LICZBA_PODWLADNYCH, ROZNICA_PENSJI)
        VALUES (r.MANAGER_ID, r.LICZBA, r.ROZNICA);
    END LOOP;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('Statystyki zostały wygenerowane i zapisane.');
END;
/

SELECT * FROM STATYSTYKI_MENEDZEROW;







